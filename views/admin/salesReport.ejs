<!DOCTYPE html>
<html lang="en">
<%- include('../partials/head', { title: 'Sales Report' }) %>

<body>
  <div class="container-fluid">
    <div class="row min-vh-100">
      <%- include('../partials/adminDashboard') %>
      <%- include('../partials/sweetAlert') %>

      <!-- Main Content -->
      <div class="col-lg-9 col-md-12 mt-5 px-4">
        
        <!-- Header with filters -->
        <div class="d-flex flex-wrap justify-content-between align-items-center mb-4">
          <h2 class="fw-bold text-primary">ðŸ“Š Sales Report- <%= filter %></h2>
          
          <!-- Date Filter -->
          <form id="reportFilter" class="d-flex gap-2" style="width: 250px; height: 50px;">
            <select id="filterType" name="filter" class="form-select">
              <option value="daily">Daily</option>
              <option value="weekly">Weekly</option>
              <option value="monthly">Monthly</option>
              <option value="yearly">Yearly</option>
            </select>
            <button type="submit" class="btn btn-primary mt-2" style="width: 200px; height: 50px;">
               Apply
            </button>
          </form>
        </div>

        <!-- Report Card -->
        <div class="card shadow-lg border-0 rounded-4">
          <div class="card-body p-4">
            <table class="table table-bordered table-striped text-center align-middle mb-0" id="reportTable">
              <thead class="table-dark">
                <tr>
                  <th>Particular</th>
                  <th>Value</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>Total Orders</td>
                  <td><%= orders %></td>
                </tr>
                <tr>
                  <td>Total Revenue</td>
                  <td>â‚¹ <%= revenue.toLocaleString() %></td>
                </tr>
                <tr>
                  <td>Total Products Sold</td>
                  <td><%= products %></td>
                </tr>
                <tr>
                  <td>Total Customers</td>
                  <td><%= customers %></td>
                </tr>
                <tr>
                  <td>Pending Payments</td>
                  <td>â‚¹ <%= pending %></td>
                </tr>
                <tr>
                  <td>Cancelled Orders</td>
                  <td><%= cancelled %></td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <!-- Download Buttons -->
        <div class="mt-4 d-flex gap-2">
          <button class="btn btn-success shadow-sm" id="downloadExcel">
            <i class="bi bi-file-earmark-excel"></i> Excel
          </button>
          <button class="btn btn-warning shadow-sm" id="downloadCSV">
            <i class="bi bi-file-earmark-text"></i> CSV
          </button>
          <button class="btn btn-danger shadow-sm" id="downloadPDF">
            <i class="bi bi-file-earmark-pdf"></i> PDF
          </button>
        </div>
      </div>

      <!-- Footer -->
      <footer class="text-center py-4 small text-muted border-top mt-4 fw-bold">
        Â© 2025 | ShopCart | All Rights Reserved | We Give You Style.
      </footer>
    </div>
  </div>

  <!-- Bootstrap & Icons -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  
  <!-- Export Libraries -->
  <script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>

  <!-- Export Scripts -->
  <script>
    const filterType = "<%= filter %>".toUpperCase();
    // Excel Export
    document.getElementById("downloadExcel").addEventListener("click", () => {
      const table = document.getElementById("reportTable");
      const wb = XLSX.utils.table_to_book(table, { sheet: `SalesReport-${filterType}` });
      XLSX.writeFile(wb, `SalesReport-${filterType}.xlsx`);
    });

    // CSV Export
    document.getElementById("downloadCSV").addEventListener("click", () => {
      const table = document.getElementById("reportTable");
      const wb = XLSX.utils.table_to_book(table, { sheet: `SalesReport_${filterType}` });
      const csv = XLSX.utils.sheet_to_csv(wb.Sheets["Sales Report"]);
      const blob = new Blob([csv], { type: "text/csv;charset=utf-8;" });
      saveAs(blob, `SalesReport-${filterType}.csv`);
    });

    // PDF Export
    document.getElementById("downloadPDF").addEventListener("click", () => {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      doc.text(`SalesReport-${filterType}`, 14, 15);
      doc.autoTable({ html: "#reportTable", startY: 20 });
      doc.save(`SalesReport-${filterType}.pdf`);
    });

    // Filter Submit
    document.getElementById("reportFilter").addEventListener("submit", function(e) {
      e.preventDefault();
      const filter = document.getElementById("filterType").value;
      window.location.href = `/admin/salesReport?filter=${filter}`;
    });
  </script>
</body>
</html>
