<!DOCTYPE html>
<html lang="en">
  <%- include('../partials/head', { title: 'User Management' }) %>
  <body>
    <div class="container-fluid">
      <div class="row min-vh-100">
        <%- include('../partials/adminDashboard') %>
        <%- include('../partials/sweetAlert') %>

        <!-- Main Content -->
        <div class="col-9 mt-5">
          <h2 class="mb-4">User Management</h2>

          <!-- Search Form -->
          <form method="GET" action="/admin/users" class="mb-3 d-flex">
            <input type="text" name="search" class="form-control me-2" value="<%= search %>" placeholder="Search by name...">
            <button class="btn btn-dark me-4">Search</button>
             <% if (search) { %>
                <a href="/admin/products" class="p-3 bg-danger btn" style="color: White;">Clear</a>
              <% } %>
          </form>

          <!-- User Table -->
          <table class="table table-bordered table-striped">
            <thead class="table-dark">
              <tr>
                <th>User ID</th>
                <th>Name</th>
                <th>Orders</th>
                <th>Wallet</th>
                <th>Status</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <% users.forEach(user => { %>
                <tr>
                  <td><%= user._id %></td>
                  <td><%= user.name %></td>
                  <td><%= user.orders %></td>
                  <td>₹<%= user.wallet %></td>
                  <td>
                    <% if (user.isBlocked) { %>
                      <b style="color: red;">Blocked</b>
                    <% } else { %>
                      <b style="color: green;">Active</b>
                    <% } %>
                  </td>
                  <td>
                    <!-- Block/Unblock -->
                    <form id="blockForm-<%= user._id %>" action="/admin/users/block/<%= user._id %>?page=<%= currentPage %>&search=<%= search %>" method="POST" style="display: inline-block;">
                      <button type="button" class="block-btn" data-id="<%= user._id %>" data-status="<%= user.isBlocked ? 'unblock' : 'block' %>" data-name="<%= user.name %>" style="border: none; background: none; padding: 0;">
                        <img 
                          src="/images/<%= user.isBlocked ? 'enable.png' : 'disable.png' %>" 
                          alt="<%= user.isBlocked ? 'Unblock' : 'Block' %>" 
                          title="<%= user.isBlocked ? 'Unblock User' : 'Block User' %>"
                          style="height: 24px; width: 24px; cursor: pointer;" 
                        />
                      </button>
                    </form>

                    <!-- Delete -->
                    <form id="deleteForm-<%= user._id %>" action="/admin/users/delete/<%= user._id %>?page=<%= currentPage %>&search=<%= search %>" method="POST" style="display: inline-block;">
                      <button type="button" class="delete-btn" data-id="<%= user._id %>" data-name="<%= user.name %>" style="border: none; background: none; padding: 0;">
                        <img 
                          src="/images/delete.png" 
                          alt="Delete User" 
                          title="Delete User"
                          style="height: 24px; width: 24px; cursor: pointer;" 
                        />
                      </button>
                    </form>
                  </td>
                </tr>
              <% }) %>
            </tbody>
          </table>

         <!-- Pagination -->
            <% if (totalPages > 1) { %>
  <nav aria-label="Page navigation">
    <ul class="pagination justify-content-center mt-4">
      <!-- Previous Button -->
      <li class="page-item <%= currentPage === 1 ? 'disabled' : '' %>">
        <a class="page-link" 
          href="/admin/users?page=<%= currentPage - 1 %>&search=<%= search %>">Previous</a>
      </li>

      <!-- Page Numbers -->
      <% for (let i = 1; i <= totalPages; i++) { %>
        <li class="page-item <%= currentPage === i ? 'active' : '' %>">
          <a class="page-link" 
            href="/admin/users?page=<%= i %>&search=<%= search %>"><%= i %></a>
        </li>
      <% } %>

      <!-- Next Button -->
      <li class="page-item <%= currentPage === totalPages ? 'disabled' : '' %>">
        <a class="page-link" 
          href="/admin/users?page=<%= currentPage + 1 %>&search=<%= search %>">Next</a>
      </li>
    </ul>
  </nav>
<% } %>


        </div>

        <footer class="text-center py-4 small text-muted border-top mt-4" style="font-weight: 700;">
          © 2025 | ShopCart | All Rights Reserved. | We Give You Style.
        </footer>
      </div>
    </div>

    <!-- Bootstrap & Icons -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

   <%- include('../partials/successAlert') %>
   
    <script src="/js/sweetAlert.js"></script>
  </body>
</html>
