<!DOCTYPE html>
<html lang="en">
<%- include('../partials/head', { title: 'ShopCart - Cart' }) %>
<body>
  <%- include('../partials/navbar') %>

  <div class="container my-5">
    <h2 class="cart-title text-center mb-4">YOUR CART</h2>
    <div class="row">
      <% if(error){%>
        <p class="text-danger"><b> <%= error %></b></p>
      <%}%>
      <!-- Cart Items -->
      <div class="col-lg-8 bg-light p-3 rounded">
        <% if(items.length !== 0) { %>
          <% items.forEach(item => { %>
            <div class="cart-item row align-items-center mb-3 p-2 border rounded" data-id="<%=item.variantId%>">
              <div class="col-4 col-md-3">
               <a href="/details/<%= item.productId %>"> <img src="<%=item.image%>" class="img-fluid rounded" alt="<%=item.name%>"></a>
              </div>
              <div class="col-8 col-md-9">
                <h6><%=item.name %> </h6>
                <p class="mb-1 text-muted"><%=item.description %></p>
                <p class="mb-1 text-muted"><%=item.fit%> • <%=item.color%> • Size: <%=item.size%></p>
                
                <p class="fw-bold">
                  <% if(item.basePrice !== item.discountPrice) { %>
                    <del>₹<%= item.basePrice %></del>
                  <% } %> 
                  ₹<%= item.discountPrice %>
                </p>

                <% if(item.stock>0){%>
                    <p class="text-success small"><b>In stock</b> </p>
                  <%} else {%>
                    <p class="text-danger small"><b>Out of stock</b> </p>

                    <% } %>
                
                <div class="d-flex align-items-center">
                    <button class="btn btn-sm btn-outline-secondary me-2 update-qty" 
                            data-id="<%=item.variantId%>" data-action="minus">-</button>
                    <input type="text" class="form-control form-control-sm text-center qty-input" 
                          style="width:50px;" value="<%=item.quantity%>" readonly>
                    <button class="btn btn-sm btn-outline-secondary ms-2 update-qty" 
                            data-id="<%=item.variantId%>" data-action="add">+</button>
                    <button class="btn btn-sm btn-danger ms-3 remove-item" 
                            data-id="<%=item.variantId%>">Remove</button>
                </div>



              </div>
            </div>
          <% }) %>
        <% } else { %>
          <h1 class="text-center" ><b>Your cart is empty.</b></h1>
        <% } %>
      </div>

      <!-- Order Summary -->
        <% if(items.length !== 0) { %>
      <div class="col-lg-4 mt-4 mt-lg-0 p-2" >
        <div class="order-summary p-3 border rounded" style="background-color: rgb(211, 215, 219);">
          <h5 class="text-center mb-3"><b>Price Details</b></h5>
          <div id="summary-items">
            <% items.forEach(item => { %>
              <p>
                <%= item.name %> ( <%= item.quantity %> items )
                <span class="float-end">₹<%= item.basePrice * item.quantity %></span>
              </p>
              <p>
                Discount 
                <span class="float-end" style="color: green;"> - ₹<%= (item.basePrice - item.discountPrice) * item.quantity %></span>
              </p>
            <% }) %>
          </div>
          <hr>
          
          

          <p class="total fw-bold">Total: <span class="float-end" id="cartTotal">₹<%= items.reduce((sum,i)=>sum+(i.discountPrice*i.quantity),0) %></span></p>
          <a  class="btn btn-dark w-100 mt-2 bg-dark"  id="continueBtn">Continue</a>
        </div>
      </div>
      <%}%>
    </div>

    
  </div>

 <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script src="/js/cart.js"></script>
 
</body>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</html>
