<!DOCTYPE html>
<html lang="en">
<%- include('../partials/head', { title: 'ShopCart - Cart' }) %>
<body>
  <%- include('../partials/navbar') %>

  <div class="container my-5">
    <h2 class="cart-title text-center mb-4">YOUR CART</h2>
    <div class="row">
      
      <!-- Cart Items -->
      <div class="col-lg-8 bg-light p-3 rounded">
        <% if(items.length !== 0) { %>
          <% items.forEach(item => { %>
            <div class="cart-item row align-items-center mb-3 p-2 border rounded" data-id="<%=item.variantId%>">
              <div class="col-4 col-md-3">
                <img src="<%=item.image%>" class="img-fluid rounded" alt="<%=item.name%>">
              </div>
              <div class="col-8 col-md-9">
                <h6><%=item.name %></h6>
                <p class="mb-1 text-muted"><%=item.description %></p>
                <p class="mb-1 text-muted"><%=item.fit%> • <%=item.color%> • Size: <%=item.size%></p>
                
                <p class="fw-bold">
                  <% if(item.basePrice !== item.discountPrice) { %>
                    <del>₹<%= item.basePrice %></del>
                  <% } %> 
                  ₹<%= item.discountPrice %>
                </p>

                <p class="text-success small">In stock • Free Delivery</p>
                
                <div class="d-flex align-items-center">
                  <a href="/cart/update/<%=item.variantId%>/minus" class="btn btn-sm btn-outline-secondary me-2 update-qty " >-</a>
                  <input type="text" class="form-control form-control-sm text-center qty-input" style="width:50px;" value="<%=item.quantity%>" readonly>
                  <a href="/cart/update/<%=item.variantId%>/add" class="btn btn-sm btn-outline-secondary ms-2 update-qty" >+</a>
                  <a href="/cart/remove/<%=item.variantId%>" class="btn btn-sm btn-danger ms-3 remove-item bg-danger">Remove</a>
                   <% if (query.error && query.vid === item.variantId.toString()) { %>
                     <p class="text-danger small mt-1"><%= query.error %></p>
                   <% } %>
                </div>
              </div>
            </div>
          <% }) %>
        <% } else { %>
          <h1 class="text-center" ><b>Your cart is empty.</b></h1>
        <% } %>
      </div>

      <!-- Order Summary -->
        <% if(items.length !== 0) { %>
      <div class="col-lg-4 mt-4 mt-lg-0 p-2" >
        <div class="order-summary p-3 border rounded" style="background-color: rgb(211, 215, 219);">
          <h5>Order Summary</h5>
          <div id="summary-items">
            <% items.forEach(item => { %>
              <p>
                <%= item.quantity %>x <%= item.name %> 
                <span class="float-end">₹<%= item.discountPrice * item.quantity %></span>
              </p>
            <% }) %>
          </div>
          <hr>
          <p class="text-success">Delivery Charges <span class="float-end">Free</span></p>
          <p>Platform Fee <span class="float-end">₹0</span></p>
          <div class="input-group my-2">
            <input type="text" id="couponCode" class="form-control form-control-sm" placeholder="Discount code">
            <button class="btn btn-danger btn-sm" id="applyCoupon">Apply</button>
          </div>
          <p class="total fw-bold">Total: <span class="float-end" id="cartTotal">₹<%= items.reduce((sum,i)=>sum+(i.discountPrice*i.quantity),0) %></span></p>
          <a href="/checkout1" class="btn btn-dark w-100 mt-2 bg-dark">Continue</a>
        </div>
      </div>
      <%}%>
    </div>
  </div>

 
</body>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</html>
