<!DOCTYPE html>
<html lang="en">
<%- include('../partials/head', { title: 'ShopCart' }) %>

    <body>
        <%- include('../partials/navbar') %>

            <section class="container my-5">
                <h3 class="text-center fw-bold" style="color: rgb(179, 74, 4);">
                    <%= genderParam === 'all' ? 'ALL PRODUCTS' : genderParam.toUpperCase() + "'S PRODUCTS" %>
                </h3>

                <p class="text-center text-muted m-4">
                    Stock up your fashion wardrobe or test a fresh 'fit. Check all products here.
                </p>

                <div class="row mt-4">
                <%- include('../partials/filters', { formAction: genderParam ? `/products/${genderParam}` : '/products', genderParam: genderParam }) %>


                    <%- include('../partials/productGrid') %>
                </div>
            </section>
<% if (totalPages> 1) { %>
<nav aria-label="Page navigation">
    <ul class="pagination justify-content-center mt-4">
        <%
        // Prepare query parameters for URL
        const buildQueryString = (params) => {
          const searchParams = new URLSearchParams();
          
          Object.keys(params).forEach(key => {
            if (Array.isArray(params[key])) {
              // Handle array values by adding multiple entries
              params[key].forEach(value => {
                searchParams.append(key, value);
              });
            } else if (params[key] !== undefined && params[key] !== null) {
              // Handle regular values
              searchParams.append(key, params[key]);
            }
          });
          
          return searchParams.toString();
        };
        %>

        <!-- Previous Button -->
        <li class="page-item <%= currentPage === 1 ? 'disabled' : '' %>">
            <a class="page-link" 
               href="?<%= buildQueryString({ ...queryParams, page: currentPage - 1 }) %>">
               Previous
            </a>
        </li>

        <!-- Page Numbers -->
        <% for (let i=1; i <=totalPages; i++) { %>
            <li class="page-item <%= currentPage === i ? 'active' : '' %>">
                <a class="page-link" 
                   href="?<%= buildQueryString({ ...queryParams, page: i }) %>">
                    <%= i %>
                </a>
            </li>
        <% } %>

        <!-- Next Button -->
        <li class="page-item <%= currentPage === totalPages ? 'disabled' : '' %>">
            <a class="page-link" 
               href="?<%= buildQueryString({ ...queryParams, page: currentPage + 1 }) %>">
               Next
            </a>
        </li>
    </ul>
</nav>
<% } %>

            <%- include('../partials/footer') %>

                <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
                <script>
                    const priceRange = document.getElementById('priceRange');
                    const priceValue = document.getElementById('priceValue');

                    priceRange.addEventListener('input', () => {
                        priceValue.textContent = priceRange.value;
                    });
                </script>
    </body>

</html>