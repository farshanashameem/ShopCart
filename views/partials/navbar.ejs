<nav class="navbar navbar-expand-lg navbar-light shadow-sm" style="background-color: rgb(244, 236, 227);">
  <div class="container">
    <!-- Logo -->
    <a class="navbar-brand fw-bold fs-4" href="/">
      <img src="/images/ShopCart.PNG" class="img-fluid logo-img" alt="ShopCart">
    </a>

    <!-- Toggle -->
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="navbarNav">
      <!-- Left links -->
      <ul class="navbar-nav me-auto align-items-center gap-3">
        <li class="nav-item"><a class="nav-link" href="/">Home</a></li>
        <li class="nav-item"><a class="nav-link" href="/products/men">Men</a></li>
        <li class="nav-item"><a class="nav-link" href="/products/women">Women</a></li>
        <li class="nav-item"><a class="nav-link" href="/products">All Products</a></li>
      </ul>

      <!-- Search -->
      <form class="d-flex me-3 position-relative" id="productFilterForm" action="/products" method="GET">
        <input
          id="searchInput"
          class="form-control rounded-pill me-2 pe-5"
          type="text"
          name="search"
          value="<%= typeof searchQuery !== 'undefined' ? searchQuery : '' %>"
          placeholder="Search for products, brands and more..."
          aria-label="Search"
          style="width: 300px;"
        >

        <button type="button" id="clearSearchBtn" class="btn position-absolute end-0 me-5"
          style="background: transparent; border: none; top: 50%; transform: translateY(-50%); display: none;">
          <i class="bi bi-x-circle text-secondary"></i>
        </button>

        <button class="btn btn-dark rounded-pill" type="submit">
          <i class="bi bi-search"></i>
        </button>
      </form>

      <!-- Right side -->
      <ul class="navbar-nav align-items-center gap-3">
        <% if (!user) { %>
          <li class="nav-item"><a class="nav-link" href="/login">Sign In</a></li>
          <li class="nav-item">
            <a href="/signup" class="ms-2 text-decoration-none rounded p-2 bg-dark text-white">Sign Up</a>
          </li>
        <% } else { %>
          <!-- Wishlist -->
          <li class="nav-item position-relative">
            <a class="nav-link" href="/wishlist">
              <i class="bi bi-heart fs-5"></i>
              <% if (wishlistCount && wishlistCount > 0) { %>
                <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">
                  <%= wishlistCount %>
                  <span class="visually-hidden">wishlist items</span>
                </span>
              <% } %>
            </a>
          </li>

          <!-- Cart -->
          <li class="nav-item position-relative">
            <a class="nav-link" href="/cart">
              <i class="bi bi-cart fs-5"></i>
              <% if (cartCount && cartCount > 0) { %>
                <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-warning text-dark">
                  <%= cartCount %>
                  <span class="visually-hidden">cart items</span>
                </span>
              <% } %>
            </a>
          </li>

          <!-- Profile -->
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" data-bs-toggle="dropdown">
              <i class="bi bi-person-circle fs-5"></i>
            </a>
            <ul class="dropdown-menu">
              <li><a class="dropdown-item" href="/profile">Profile</a></li>
              <li><a class="dropdown-item" href="/orders">My Orders</a></li>
              <li><a class="dropdown-item" href="/logout">Logout</a></li>
            </ul>
          </li>
        <% } %>
      </ul>
    </div>

    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
  </div>
</nav>

<!-- Optional: CSS for better badge placement -->
<style>
  .badge {
    font-size: 11px;
    padding: 3px 6px;
    transform: translate(20%, -20%);
    
  }
  .nav-link i:hover {
    color: #ff6f00;
    transition: color 0.2s;
  }
</style>

<script>
  const searchInput = document.getElementById("searchInput");
  const clearBtn = document.getElementById("clearSearchBtn");

  searchInput.addEventListener("input", () => {
    clearBtn.style.display = searchInput.value ? "block" : "none";
  });

  clearBtn.addEventListener("click", () => {
    searchInput.value = "";
    clearBtn.style.display = "none";
    window.location.href = "/products";
  });

  if (searchInput.value) clearBtn.style.display = "block";
</script>
